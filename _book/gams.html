<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 GAMs | Workshop: Introduction to GAMs</title>
  <meta name="description" content="An introduction to GAM given as a workshop to the Journal Club UNALM community" />
  <meta name="generator" content="bookdown 0.22.3 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 GAMs | Workshop: Introduction to GAMs" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to GAM given as a workshop to the Journal Club UNALM community" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 GAMs | Workshop: Introduction to GAMs" />
  
  <meta name="twitter:description" content="An introduction to GAM given as a workshop to the Journal Club UNALM community" />
  

<meta name="author" content="Diego Villa" />


<meta name="date" content="2021-06-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="inter-flex.html"/>
<link rel="next" href="application.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to GAMs</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#a-little-about-me"><i class="fa fa-check"></i>A little about me</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i>Setup</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="inter-flex.html"><a href="inter-flex.html"><i class="fa fa-check"></i><b>2</b> Interpretability vs.Â flexibility</a></li>
<li class="chapter" data-level="3" data-path="gams.html"><a href="gams.html"><i class="fa fa-check"></i><b>3</b> GAMs</a>
<ul>
<li class="chapter" data-level="3.1" data-path="gams.html"><a href="gams.html#def"><i class="fa fa-check"></i><b>3.1</b> Definition</a></li>
<li class="chapter" data-level="3.2" data-path="gams.html"><a href="gams.html#smooth"><i class="fa fa-check"></i><b>3.2</b> Smoothing</a></li>
<li class="chapter" data-level="3.3" data-path="gams.html"><a href="gams.html#pena"><i class="fa fa-check"></i><b>3.3</b> Penalization</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="application.html"><a href="application.html"><i class="fa fa-check"></i><b>4</b> Application</a></li>
<li class="chapter" data-level="5" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>5</b> Resources</a>
<ul>
<li class="chapter" data-level="" data-path="resources.html"><a href="resources.html#books"><i class="fa fa-check"></i>Books</a></li>
<li class="chapter" data-level="" data-path="resources.html"><a href="resources.html#papers"><i class="fa fa-check"></i>Papers</a></li>
<li class="chapter" data-level="" data-path="resources.html"><a href="resources.html#online-courses"><i class="fa fa-check"></i>Online courses</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop: Introduction to GAMs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="gams" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> GAMs</h1>
<div id="def" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Definition</h2>
<p>GAMs are a extension to the <em>Generalized Linear Models</em> (GLMs). A GLM consists on equating some function, called the <em>link function</em>, of the mean of the response variable with a linear combination of the predictors, named the <em>linear predictor</em>. Here, the response is assumed to follow a <em>Exponential Family</em> (EF) distribution. GAMs extents this by letting the linear predictor to include smooth functions over the predictors as terms in the linear combination. These smooth functions allow us to specify the association between the response and the predictors using non-linear continuous forms.</p>
<p>In general, GAMs have the following structure:</p>
<p><span class="math display" id="eq:gam">\[
\eta\left(\mu\right) = X\beta + \gamma_{1}(X_{1}) + \gamma_{1}(X_{2}) + \ldots + \gamma_{p}(X_{p}) + \ldots
\tag{3.1}
\]</span>
where <span class="math inline">\(\eta\)</span> is the link function, <span class="math inline">\(\mu = E(Y)\)</span>, <span class="math inline">\(X\beta\)</span> represents the parameterized part of the linear predictor, as in a GLM, and the functions <span class="math inline">\(\eta\)</span> are smooth functions over different sets of predictors. Here the <span class="math inline">\(X\)</span>s represent the matrix form of a set of predictors rather than single predictors. Recall that it is assumed that <span class="math inline">\(Y\)</span> follows a particular EF distribution.</p>
</div>
<div id="smooth" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Smoothing</h2>
<p>The main attraction of GAMs are the smooth functions. We are left with two problems: how to specify these smooth functions and how much âsmoothyâ or âwigglyâ should they be? To construct the smooth functions, we use their <em>basis expansion</em>. That means that we express each smooth function as a finite linear combination of another functions, called <em>basis functions</em>, which are assumed to approximate the space of functions that the smooth function is part of. Functions constructed like this are called <em>splines</em>.</p>
<p>For a particular smooth function, we can write</p>
<p><span class="math display" id="eq:smooth">\[
\begin{equation}
\gamma(x) = \sum_{j=1}^{K}{\delta_{j}b_{j}(x)}
\tag{3.2}
\end{equation}
\]</span></p>
<p>where <span class="math inline">\(\delta_{i}\)</span> are the coefficients for the linear combination of the basis functions <span class="math inline">\(b_{i}\)</span>. Here, <span class="math inline">\(K\)</span> is the number of basis functions in the linear combination, and it represents the <em>basis complexity</em> or <em>basis size</em>. This parameter is important because it controls the form of the resulting smooth function. Greater values result in a very <em>wiggly</em> smooth function, whereas lower values result in a plainer smooth function. In the univariate case, if we set the basis functions to be the polynomials of <span class="math inline">\(x\)</span> up to the third degree, then <span class="math inline">\(b_{1}(x) = 1\)</span>, <span class="math inline">\(b_{2}(x) = x\)</span>, <span class="math inline">\(b_{3}(x) = x^2\)</span> and <span class="math inline">\(b_{4}(x) = x^3\)</span>, and the smooth function is represented as a third degree polynomial in <span class="math inline">\(x\)</span>, <span class="math inline">\(\gamma(x) = \delta_{1}+\delta_{2}x+\delta_{3}x^2+\delta_{4}x^3\)</span>.</p>
<p>Different splines can be specified using different types of basis functions. A very popular type are the B-splines which are constructed using piecewise polynomial basis functions. Letâs see how the B-splines are constructed and fitted to the data in <a href="intro.html#intro">1</a> for different numbers of basis size using a GLM.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="gams.html#cb5-1" aria-hidden="true" tabindex="-1"></a>zoo_example <span class="ot">&lt;-</span> <span class="fu">filter</span>(zooplankton, taxon <span class="sc">==</span> <span class="st">&quot;D. thomasi&quot;</span>, lake <span class="sc">==</span> <span class="st">&quot;Mendota&quot;</span>)</span>
<span id="cb5-2"><a href="gams.html#cb5-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> zoo_example<span class="sc">$</span>day</span>
<span id="cb5-3"><a href="gams.html#cb5-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> zoo_example<span class="sc">$</span>density_adj</span>
<span id="cb5-4"><a href="gams.html#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="gams.html#cb5-5" aria-hidden="true" tabindex="-1"></a>get_bspline <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb5-6"><a href="gams.html#cb5-6" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">bs</span>(x, <span class="at">df =</span> k, <span class="at">degree =</span> <span class="dv">2</span>)</span>
<span id="cb5-7"><a href="gams.html#cb5-7" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> b, <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb5-8"><a href="gams.html#cb5-8" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">sweep</span>(<span class="fu">cbind</span>(<span class="dv">1</span>, b), <span class="dv">2</span>, <span class="fu">coef</span>(m), <span class="st">&quot;*&quot;</span>)</span>
<span id="cb5-9"><a href="gams.html#cb5-9" aria-hidden="true" tabindex="-1"></a>  db <span class="ot">&lt;-</span> z[, <span class="dv">2</span><span class="sc">:</span>(k<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb5-10"><a href="gams.html#cb5-10" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(z)</span>
<span id="cb5-11"><a href="gams.html#cb5-11" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(db)</span>
<span id="cb5-12"><a href="gams.html#cb5-12" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, db)</span>
<span id="cb5-13"><a href="gams.html#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">b =</span> b, <span class="at">l =</span> l, <span class="at">db =</span> db, <span class="at">g =</span> g, <span class="at">s =</span> s))</span>
<span id="cb5-14"><a href="gams.html#cb5-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-15"><a href="gams.html#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="gams.html#cb5-16" aria-hidden="true" tabindex="-1"></a>plt_bspline <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb5-17"><a href="gams.html#cb5-17" aria-hidden="true" tabindex="-1"></a>  bspline <span class="ot">&lt;-</span> <span class="fu">get_bspline</span>(k)</span>
<span id="cb5-18"><a href="gams.html#cb5-18" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> bspline<span class="sc">$</span>g</span>
<span id="cb5-19"><a href="gams.html#cb5-19" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> bspline<span class="sc">$</span>s</span>
<span id="cb5-20"><a href="gams.html#cb5-20" aria-hidden="true" tabindex="-1"></a>  s_pivot <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(s, <span class="at">cols =</span> <span class="sc">!</span>x, <span class="at">names_to =</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb5-21"><a href="gams.html#cb5-21" aria-hidden="true" tabindex="-1"></a>  plt <span class="ot">&lt;-</span> </span>
<span id="cb5-22"><a href="gams.html#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-23"><a href="gams.html#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> g), <span class="at">lwd =</span> <span class="fl">0.65</span>) <span class="sc">+</span></span>
<span id="cb5-24"><a href="gams.html#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> s_pivot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">col =</span> b)) <span class="sc">+</span></span>
<span id="cb5-25"><a href="gams.html#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-26"><a href="gams.html#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="fu">expression</span>(gamma), <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&quot;K = &quot;</span>, k)) <span class="sc">+</span></span>
<span id="cb5-27"><a href="gams.html#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb5-28"><a href="gams.html#cb5-28" aria-hidden="true" tabindex="-1"></a>  plt</span>
<span id="cb5-29"><a href="gams.html#cb5-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-30"><a href="gams.html#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="gams.html#cb5-31" aria-hidden="true" tabindex="-1"></a>plt_bs_k2 <span class="ot">&lt;-</span> <span class="fu">plt_bspline</span>(<span class="dv">2</span>)</span>
<span id="cb5-32"><a href="gams.html#cb5-32" aria-hidden="true" tabindex="-1"></a>plt_bs_k5 <span class="ot">&lt;-</span> <span class="fu">plt_bspline</span>(<span class="dv">5</span>)</span>
<span id="cb5-33"><a href="gams.html#cb5-33" aria-hidden="true" tabindex="-1"></a>plt_bs_k10 <span class="ot">&lt;-</span> <span class="fu">plt_bspline</span>(<span class="dv">10</span>)</span>
<span id="cb5-34"><a href="gams.html#cb5-34" aria-hidden="true" tabindex="-1"></a>plt_bs_k20 <span class="ot">&lt;-</span> <span class="fu">plt_bspline</span>(<span class="dv">20</span>)</span>
<span id="cb5-35"><a href="gams.html#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="gams.html#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plt_bs_k2, plt_bs_k5, plt_bs_k10, plt_bs_k20, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:b-splines"></span>
<img src="intro-to-gam_files/figure-html/b-splines-1.png" alt="Smooth function contructed as a B-spline using different values of basis complexity (K)" width="1152" />
<p class="caption">
Figure 3.1: Smooth function contructed as a B-spline using different values of basis complexity (K)
</p>
</div>
<p>In each panel of <a href="gams.html#fig:b-splines">3.1</a>, the colored curves are the basis functions time their fitted coefficients, and the summation of these terms yield the smooth function following <a href="gams.html#eq:smooth">(3.2)</a>. We can see that increasing the basis complexity yields a less smoothed function with more wiggliness, that is, a more complex function. Letâs see how these smooth functions fit the data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="gams.html#cb6-1" aria-hidden="true" tabindex="-1"></a>plt_manual_bs <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb6-2"><a href="gams.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  bspline <span class="ot">&lt;-</span> <span class="fu">get_bspline</span>(k)</span>
<span id="cb6-3"><a href="gams.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span> bspline<span class="sc">$</span>l</span>
<span id="cb6-4"><a href="gams.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, l)</span>
<span id="cb6-5"><a href="gams.html#cb6-5" aria-hidden="true" tabindex="-1"></a>  plt <span class="ot">&lt;-</span> </span>
<span id="cb6-6"><a href="gams.html#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-7"><a href="gams.html#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-8"><a href="gams.html#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">exp</span>(l), <span class="at">colour =</span> <span class="st">&quot;bs&quot;</span>)) <span class="sc">+</span></span>
<span id="cb6-9"><a href="gams.html#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_npg</span>() <span class="sc">+</span></span>
<span id="cb6-10"><a href="gams.html#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>),</span>
<span id="cb6-11"><a href="gams.html#cb6-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0.1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;100&quot;</span>, <span class="st">&quot;1000&quot;</span>)) <span class="sc">+</span></span>
<span id="cb6-12"><a href="gams.html#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Day of year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Population density&quot;</span>, </span>
<span id="cb6-13"><a href="gams.html#cb6-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&quot;K = &quot;</span>, k)) <span class="sc">+</span></span>
<span id="cb6-14"><a href="gams.html#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb6-15"><a href="gams.html#cb6-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-16"><a href="gams.html#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="gams.html#cb6-17" aria-hidden="true" tabindex="-1"></a>plt_manual_bs_k2 <span class="ot">&lt;-</span> <span class="fu">plt_manual_bs</span>(<span class="dv">2</span>)</span>
<span id="cb6-18"><a href="gams.html#cb6-18" aria-hidden="true" tabindex="-1"></a>plt_manual_bs_k5 <span class="ot">&lt;-</span> <span class="fu">plt_manual_bs</span>(<span class="dv">5</span>)</span>
<span id="cb6-19"><a href="gams.html#cb6-19" aria-hidden="true" tabindex="-1"></a>plt_manual_bs_k10 <span class="ot">&lt;-</span> <span class="fu">plt_manual_bs</span>(<span class="dv">10</span>)</span>
<span id="cb6-20"><a href="gams.html#cb6-20" aria-hidden="true" tabindex="-1"></a>plt_manual_bs_k20 <span class="ot">&lt;-</span> <span class="fu">plt_manual_bs</span>(<span class="dv">20</span>)</span>
<span id="cb6-21"><a href="gams.html#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="gams.html#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plt_manual_bs_k2, plt_manual_bs_k5, plt_manual_bs_k10, </span>
<span id="cb6-23"><a href="gams.html#cb6-23" aria-hidden="true" tabindex="-1"></a>             plt_manual_bs_k20, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:zoo-bs"></span>
<img src="intro-to-gam_files/figure-html/zoo-bs-1.png" alt="Regression B-splines in a GLM using different values of basis complexity (K)" width="1152" />
<p class="caption">
Figure 3.2: Regression B-splines in a GLM using different values of basis complexity (K)
</p>
</div>
<p>In <a href="gams.html#fig:zoo-bs">3.2</a> the see that increasing the basis size of the B-splines results in overfitting, which is something we want to avoid. On the other hand, a small basis size is too simple to capture the association.</p>
</div>
<div id="pena" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Penalization</h2>
<p>Another way to control the complexity or wiggliness of the smooth functions in to penalize for their complexity in the objective function of the model. This is where GAMs depart from the GLMs. Recall the in a GLM, the objective function is the likelihood of the model. That is, we want to maximize it in order to get a good fit. In GAMs, the objective function is the <em>penalized likelihood</em>, which consists on the likelihood plus a penalty term on the complexity of the smooth functions. The penalty is on the coefficients of the basis functions in <a href="gams.html#fig:b-splines">3.1</a>. Thus, we can write</p>
<p><span class="math display" id="eq:likeli">\[
\begin{equation}
l_{p}(\delta) = l(\delta) + \lambda\delta&#39;S\delta
\tag{3.3}
\end{equation}
\]</span></p>
<p>where <span class="math inline">\(l_{p}(\delta)\)</span> is the penalized likelihood, <span class="math inline">\(l(\delta)\)</span> is the regular likelihood, and the penalized term consists on a <em>penalization parameter</em> or <em>smoothing parameter</em> <span class="math inline">\(\lambda\)</span> and a penalty matrix <span class="math inline">\(S\)</span>. The smoothing parameter is the one that control how much penalization we do over the complexity of the smooth functions. The penalty matrix is specific to the type of basis functions we are using, and they specify how the penalization is made. From both of them, the smoothing parameter is the most important one, and here we are going to analyze how its magnitude affect the form of the smooth function.</p>
<p>Before diving in the analysis of the smoothing parameter, we are going to talk about briefly about the implementation of GAMs we are using in {R}. The <code>mgcv</code> package is the recommended option to work with, as it offers different fitting procedures, a large range of smooth functions specifications, and, perhaps the main feature, automatic estimation of the smoothing parameters. The latter is done by three methods: <em>Generalized Cross Validation</em> (GCV), <em>Restricted Marginal Likelihood</em> (REML), and <em>Integrated Nested Laplace Approximation</em> (INLA) for fully Bayesian inference. For general purposes, REML is the recommended option. The default option to construct the smooth functions in <code>mgcv</code> is using <em>Thin Plate</em> (TP) regression splines, because they donât depend on knot placement and we can build smooth functions of several variables with them. For an exhaustive review of GAMs and this implementation in {R} please refer to <span class="citation"><a href="#ref-wood2017generalized" role="doc-biblioref">Wood</a> (<a href="#ref-wood2017generalized" role="doc-biblioref">2017</a>)</span>.</p>
<p>A remark: the basis complexity is not penalized. Instead of that, it is usually set to a large value and then its complexity is regularized using the penalty term. Now we are going to fit GAMs to the zooplankton example data setting the basis complexity to 50 and using different values for the smooth parameter (SP).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="gams.html#cb7-1" aria-hidden="true" tabindex="-1"></a>plt_gam_sp <span class="ot">&lt;-</span> <span class="cf">function</span>(sp) {</span>
<span id="cb7-2"><a href="gams.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">gam</span>(y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">&quot;tp&quot;</span>, <span class="at">k =</span> <span class="dv">50</span>, <span class="at">sp =</span> sp), <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>,</span>
<span id="cb7-3"><a href="gams.html#cb7-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb7-4"><a href="gams.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-5"><a href="gams.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, pred)</span>
<span id="cb7-6"><a href="gams.html#cb7-6" aria-hidden="true" tabindex="-1"></a>  plt <span class="ot">&lt;-</span> </span>
<span id="cb7-7"><a href="gams.html#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-8"><a href="gams.html#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-9"><a href="gams.html#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> pred, <span class="at">colour =</span> <span class="st">&quot;sp&quot;</span>)) <span class="sc">+</span></span>
<span id="cb7-10"><a href="gams.html#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_npg</span>() <span class="sc">+</span></span>
<span id="cb7-11"><a href="gams.html#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>),</span>
<span id="cb7-12"><a href="gams.html#cb7-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0.1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;100&quot;</span>, <span class="st">&quot;1000&quot;</span>)) <span class="sc">+</span></span>
<span id="cb7-13"><a href="gams.html#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Day of year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Population density&quot;</span>, </span>
<span id="cb7-14"><a href="gams.html#cb7-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&quot;SP = &quot;</span>, <span class="fu">as.character</span>(sp))) <span class="sc">+</span></span>
<span id="cb7-15"><a href="gams.html#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb7-16"><a href="gams.html#cb7-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-17"><a href="gams.html#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="gams.html#cb7-18" aria-hidden="true" tabindex="-1"></a>plt_gam_sp1 <span class="ot">&lt;-</span> <span class="fu">plt_gam_sp</span>(<span class="fl">0.0001</span>)</span>
<span id="cb7-19"><a href="gams.html#cb7-19" aria-hidden="true" tabindex="-1"></a>plt_gam_sp2 <span class="ot">&lt;-</span> <span class="fu">plt_gam_sp</span>(<span class="fl">0.001</span>)</span>
<span id="cb7-20"><a href="gams.html#cb7-20" aria-hidden="true" tabindex="-1"></a>plt_gam_sp3 <span class="ot">&lt;-</span> <span class="fu">plt_gam_sp</span>(<span class="fl">0.01</span>)</span>
<span id="cb7-21"><a href="gams.html#cb7-21" aria-hidden="true" tabindex="-1"></a>plt_gam_sp4 <span class="ot">&lt;-</span> <span class="fu">plt_gam_sp</span>(<span class="fl">0.1</span>)</span>
<span id="cb7-22"><a href="gams.html#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="gams.html#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plt_gam_sp1, plt_gam_sp2, plt_gam_sp3, plt_gam_sp4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:gam-sp"></span>
<img src="intro-to-gam_files/figure-html/gam-sp-1.png" alt="GAM models fitted using different values for the smoothing parameter." width="1152" />
<p class="caption">
Figure 3.3: GAM models fitted using different values for the smoothing parameter.
</p>
</div>
<p>In <a href="gams.html#fig:gam-sp">3.3</a> we observe that, despite the basis size being quite large, the smoothing parameter is essential to control the complexity of the model. A very small smoothing parameter offers less penalization, that why the model in the first plot overfits drastically the data. On the other hand, the same model with a larger smoothing parameter as in the last plot is better regularized and yields a better fit.</p>
<p>In this section we have very briefly talked about smoothing and penalization, which are the main concepts in GAMs. We strongly encourage to the curious reader to check the work of <span class="citation"><a href="#ref-wood2017generalized" role="doc-biblioref">Wood</a> (<a href="#ref-wood2017generalized" role="doc-biblioref">2017</a>)</span>, which is the most cited reference in GAMs theory and application. In the next section, we are going to work on a full example on the zooplankton data to show more of the features the GAMs have.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-wood2017generalized" class="csl-entry">
Wood, Simon N. 2017. <em>Generalized Additive Models: An Introduction with <span>R</span></em>. CRC press.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="inter-flex.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="application.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["intro-to-gam.pdf", "intro-to-gam.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
